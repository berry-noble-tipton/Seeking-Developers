<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <th:block th:include="partials/header :: header" >
    </th:block>
    <title>Profile</title>
    <link rel="stylesheet" href="/css/profile.css" />
    <link rel="stylesheet" href="/css/navbar-user.css"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
</head>
<body>
<script src="//static.filestackapi.com/filestack-js/3.x.x/filestack.min.js"></script>
<script>
    const client = filestack.init('ADhg7cXQTXmfBbbTxghC6z');
    let options = {
        "maxFiles": 1,
        "accept": [
            "image/*"
        ],
        "fromSources": [
            "local_file_system"
        ],
        onUploadDone: file=>{
            console.log(file);
            file = file.filesUploaded[0];
            document.getElementById("imageURL").value=file.url;
            document.getElementById("imageForm").submit();
        }
    };
</script>
<nav th:replace="partials/navbar-user :: user-nav"></nav>

    <div class="container-fluid" th:each="user : ${user}">
        <div class="row">
            <div class="card user-box col-md-4 col-sm-12 mx-auto pro">
                <img class="user mx-auto" th:src="${user.photo}" />
                <h3 align="center" th:text="${user.username}"></h3>
                <h5 align="center" th:text="${user.email}"></h5>
                <form th:action="@{/profile}" class="mx-auto" id="imageForm" th:method="post">
                    <input name="imageURL" id="imageURL" type="hidden"/>
                    <input type="button" class="btn btn-primary mx-auto" onclick="client.picker(options).open();" value="Upload Picture"/>
                </form>
                <form th:action="@{/profile/edit}" th:method="GET">
                    <input type="submit" class="btn btn-primary mx-auto" value="Edit Profile" />
                </form>
            </div>

            <div class="card col-md-5 col-sm-12 mx-auto pro">
                <div class="card-body">
                    <h3 class="card-title" align="center">Biography:</h3>
                    <p class="card-text" th:text="${user.bio}">Insert bio script here: </p>
                </div>
                <hr />
                <div class="card-body">
                    <h3 class="card-title" align="center">Favorite Users:</h3>
                    <div th:each="favorite_user : ${favorite_users}">
                        <br />
                        <a th:href="'/users/' + ${favorite_user.id} + '/profile'">
                            <h4 th:text="${favorite_user.username}"></h4>
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="card col-md-3 col-sm-12 mx-auto pro" align="center">
                <h3>Current Project: </h3>
                <div th:each="project : ${lastProject}">
                    <br />
                    <h3 th:text="${project.title}">Insert current project script here:</h3>
                    <p th:text="*{project.description}"></p>
                    <form th:action="@{'/projects/' + ${project.id} + '/single-project'}" th:method="GET">
                        <input type="hidden" name="idEdit" th:value="${project.id}" />
                        <button type="submit" class="btn btn-primary">View this project</button>
                    </form>
                </div>
            </div>

            <div class="card col-md-2 col-sm-12 mx-auto pro" align="center">
                <h3>Languages: </h3>
                <p class="card-text" th:each="language : ${langs}" th:text="${language.language}">
                </p>
            </div>

            <div class="card col-md-3 col-sm-12 mx-auto pro" align="center">
                <h3> Completed Projects:</h3>
                <br />
                <div th:each="completedProject : ${completedProjects}">
                    <h4 th:text="${completedProject.title}"></h4>
                </div>
            </div>
        </div>
    </div>

<footer th:replace="partials/footer :: footer"></footer>

</body>
</html>

